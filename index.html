<html>

<head>
  <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
  <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
  <!-- include ar.js for A-Frame -->
  <script src="https://jeromeetienne.github.io/AR.js/aframe/build/aframe-ar.js"></script>
  <link rel="stylesheet" href="styles.css" />
</head>

<body style='margin : 10px; overflow: hidden;'>
  <div class="main">
    <a-scene embedded arjs vr-mode-ui="enabled: false">
      <a-box position="-1 0.5 -10" rotation="0 45 0" scale="1 0.5 1" color="#4CC3D9"
        material="color: #d2a21e; opacity: 0.5; emissive: #654001" geometry="">
      </a-box>
      <a-camera camera="fov: 60"></a-camera>
    </a-scene>
    <button id="recording-toggle">Start recording</button>
  </div>
  <script defer>
    var RECORDING_ONGOING = false;
    var recordingToggle = document.getElementById("recording-toggle"); // The button

    recordingToggle.addEventListener("click", function () {
      RECORDING_ONGOING = !RECORDING_ONGOING; // Start / Stop recording
      if (RECORDING_ONGOING) {
        recordingToggle.innerHTML = "Stop Recording";
        startRecording(); // Start the recording
      } else {
        recordingToggle.innerHTML = "Start Recording";
        stopRecording(); // Stop screen recording
      }
    });
    var blob, deviceRecorder = null;
    var chunks = [];

    async function startRecording() {
      var stream = await navigator.mediaDevices.getDisplayMedia({ video: { mediaSource: "screen" }, audio: true })

      deviceRecorder = new deviceRecorder(stream, { mimeType: "video/webm" });
      deviceRecorder.ondataavailable = (e) => {
        if (e.data.size > 0) {
          chunks.push(e.data);
        }
      }
      deviceRecorder.onstop = () => {
        chunks = [];
      }
      deviceRecorder.start(250)
    }
    console.log(deviceRecorder.isTypeSupported("video/webm"))
    console.log(deviceRecorder.isTypeSupported("video/mp4"))
    console.log(deviceRecorder.isTypeSupported("video/mp4;codecs=avc1"))

    function stopRecording() {
      var filename = window.prompt("File name", "video"); // Ask the file name

      deviceRecorder.stop(); // Stopping the recording
      blob = new Blob(chunks, { type: "video/webm" })
      chunks = [] // Resetting the data chunks
      var dataDownloadUrl = URL.createObjectURL(blob);

      // Downloadin it onto the user's device
      let a = document.createElement('a')
      a.href = dataDownloadUrl;
      a.download = `${filename}.webm`
      a.click()

      URL.revokeObjectURL(dataDownloadUrl)

    }
  </script>
</body>

</html>
